# kubeadm config images list --kubernetes-version v1.20.0
name: GitGoogleContainer
on:
  push:
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # - uses: actions/checkout@v2
      - name: install kubeadm
        run: |
          RELEASE="$(curl -sSL https://dl.k8s.io/release/stable.txt)"
          cd /usr/bin
          curl -L --remote-name-all https://storage.googleapis.com/kubernetes-release/release/${RELEASE}/bin/linux/amd64/kubeadm
          chmod +x kubeadm
      - name: Login in Docker Registry
        uses: docker/login-action@v1
        with:
          registry: ghcr.io
          username: ${{ github.repository_owner }}
          password: ${{ secrets.GHCR_IO_TOKEN }} 
      - name: Docker pull 
        run: |
          images=$(kubeadm config images list --kubernetes-version v1.20.5)
          for i in $test;do
            docker pull $i;
          done 
      - name: Docker push ghcr.io
        run: |
          for i in $test;do
            docker tag  $i ghcr.io/${i#*/}
            docker push ghcr.io/${i#*/}
          done
          
      - name: Login in Docker Registry Main
        uses: docker/login-action@v1
        with:
         username: ${{ secrets.DOCKER_USERNAME }}
         password: ${{ secrets.DOCKER_PASSWORD }}
      - name: Docke push Main
        run: |
          for i in $test;do
            docker tag  $i imwl/${i#*/}
            docker push imwl/${i#*/}
          done
          

# kubeadm config images list --kubernetes-version v1.20.0
name: normal-image
on:
  push:
    branches:
      - normal-image
env:
  kube_version: v1.20.1
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      # - uses: actions/checkout@v2
      - name: Login in Docker Registry
        uses: docker/login-action@v1
        with:
          registry: ghcr.io
          username: ${{ github.repository_owner }}
          password: ${{ secrets.GHCR_IO_TOKEN }} 
      - name: Docker pull 
        run: |
          docker pull quay.io/fluentd_elasticsearch/elasticsearch:v7.4.3
 
      - name: Docker Get Images
        run: |
          docker_orgin_images=$(docker image ls --format "{{.Repository}}:{{.Tag}}")
          echo $docker_orgin_images > ~/images.txt
          
      - name: Docker push ghcr.io
        run: |
          images=$(cat ~/images.txt)
          for i in $images;do
            docker tag  $i ghcr.io/${{ github.repository_owner }}/${i##*/}
            docker push ghcr.io/${{ github.repository_owner }}/${i##*/}
          done
          
      - name: Login in Docker Registry 
        uses: docker/login-action@v1
        with:
         username: ${{ secrets.DOCKER_USERNAME }}
         password: ${{ secrets.DOCKER_PASSWORD }}
         
      - name: Docke push 
        run: |
          images=$(cat ~/images.txt)
          for i in $images;do
            docker tag  $i ${{ secrets.DOCKER_USERNAME }}/${i##*/}
            docker push ${{ secrets.DOCKER_USERNAME }}/${i##*/}
          done
          
